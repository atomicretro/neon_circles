(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,n(s.key),s)}}function s(t,e,s){return e&&i(t.prototype,e),s&&i(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}function n(e){var i=function(e){if("object"!=t(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var s=i.call(e,"string");if("object"!=t(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(i)?i:i+""}var a=function(){return s((function t(i){e(this,t),this.size=i,this.pool=[]}),[{key:"get",value:function(t){this.pool[this.size-1].spawned||(this.pool[this.size-1].spawn(t),this.pool.unshift(this.pool.pop()))}},{key:"draw",value:function(t){for(var e=0;e<this.size&&this.pool[e].spawned;e++)this.pool[e].draw(this.BulletPool),this.pool[e].resetable()&&(this.pool[e].setDefaultValues(t),this.pool.push(this.pool.splice(e,1)[0]))}}])}(),o=function(){return s((function t(i,s,n,a,o,r){e(this,t),this.context=i,this.image=s,this.srcWidth=n,this.srcHeight=a,this.srcX=o,this.srcY=r,this.draw=this.draw.bind(this)}),[{key:"draw",value:function(t,e){this.context.drawImage(this.image,this.srcX,this.srcY,this.srcWidth,this.srcHeight,t,e,this.srcWidth,this.srcHeight)}}])}(),r=function(){return s((function t(i){var s=this;e(this,t),this.game=i,this.backgroundMusic=new Audio("assets/sounds/background_music.mp3"),this.backgroundMusic.loop=!0,this.backgroundMusic.volume=.25,this.backgroundMusic.load(),this.checkReadyState=this.checkReadyState.bind(this),this.checkAudio=window.setInterval((function(){s.checkReadyState()}),1e3),this.mouthDemon={image:new Image,width:30,height:30,srcX:0,srcY:0},this.eyeDemon={image:new Image,width:30,height:30,srcX:0,srcY:0},this.faceDemon={image:new Image,width:30,height:40,srcX:0,srcY:0},this.faceDemonHurt={image:new Image,width:30,height:40,srcX:0,srcY:0},this.bossDemon={image:new Image,width:50,height:54,srcX:0,srcY:0},this.heart={image:new Image},this.hp={image:new Image,width:25,height:25,srcX:0,srcY:0},this.numAssets=8,this.numLoaded=0,this.mouthDemon.image.onload=function(){s.assetLoaded()},this.eyeDemon.image.onload=function(){s.assetLoaded()},this.faceDemon.image.onload=function(){s.assetLoaded()},this.faceDemonHurt.image.onload=function(){s.assetLoaded()},this.bossDemon.image.onload=function(){s.assetLoaded()},this.heart.image.onload=function(){s.assetLoaded()},this.hp.image.onload=function(){s.assetLoaded()},this.mouthDemon.image.src="assets/sprites/mouth_demon.png",this.eyeDemon.image.src="assets/sprites/eye_demon.png",this.faceDemon.image.src="assets/sprites/face_demon.png",this.faceDemonHurt.image.src="assets/sprites/face_demon_hurt.png",this.bossDemon.image.src="assets/sprites/boss_demon.png",this.heart.image.src="assets/sprites/heart.png",this.hp.image.src="assets/sprites/hp.png"}),[{key:"checkReadyState",value:function(){4===this.backgroundMusic.readyState&&(window.clearInterval(this.checkAudio),this.assetLoaded())}},{key:"assetLoaded",value:function(){this.numLoaded++,this.numLoaded===this.numAssets&&this.game.startGame()}}])}();function c(t,e){var i,s,n=e;this.pause=function(){window.clearTimeout(i),n-=new Date-s},this.resume=function(){s=new Date,window.clearTimeout(i),i=window.setTimeout(t,n)},this.clear=function(){window.clearTimeout(i)},this.resume()}var h=function(t,e){return Math.floor(Math.random()*(e-t+1))+t};function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function u(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,f(s.key),s)}}function p(t,e,i){return e&&u(t.prototype,e),i&&u(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function f(t){var e=function(t){if("object"!=l(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=l(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==l(e)?e:e+""}function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function v(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(v=function(){return!!t})()}function y(t){return y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},y(t)}function m(t,e){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},m(t,e)}var x=function(t){function e(t,i,s){var n,a,o,r;d(this,e),a=this,r=[t],o=y(o=e),n=function(t,e){if(e&&("object"==l(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(a,v()?Reflect.construct(o,r||[],y(a).constructor):o.apply(a,r));for(var c=0;c<t;c++){var h=new g(i,s);n.pool.push(h)}return n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&m(t,e)}(e,t),p(e)}(a),g=function(){return p((function t(e,i){d(this,t),this.ctx=e.ctx,this.ctxWidth=e.width,this.ctxHeight=e.height,this.resetX=e.width+5,this.resetY=e.height+5,this.setDefaultValues(i)}),[{key:"spawn",value:function(t){this.pathAngle=t.theta,this.startRadius=t.startRadius,this.endRadius=t.endRadius,this.speed=t.speed,this.startPoint=this.computePoint(this.startRadius),this.endPoint=this.computePoint(this.endRadius),this.spawned=!0}},{key:"draw",value:function(){this.startRadius-=this.speed,this.endRadius-=this.speed,this.startPoint=this.computePoint(this.startRadius),this.endPoint=this.computePoint(this.endRadius),this.clear()}},{key:"resetable",value:function(){return!((this.startPoint.y>-5||this.endPoint.y>-5)&&(this.startPoint.y<this.resetY||this.endPoint.y<this.resetY)&&(this.startPoint.x>-5||this.endPoint.x>-5)&&(this.startPoint.x<this.resetX||this.endPoint.x<this.resetX))}},{key:"clear",value:function(){var t,e;t=this.startPoint.x>this.endPoint.x?this.endPoint.x:this.startPoint.x,e=this.startPoint.y>this.endPoint.y?this.endPoint.y:this.startPoint.y,this.ctx.clearRect(t,e,16,16)}},{key:"computePoint",value:function(t){return{x:Math.cos(this.pathAngle)*-t+this.xOffset-5,y:Math.sin(this.pathAngle)*-t+this.yOffset-5}}},{key:"setDefaultValues",value:function(t){this.xOffset=this.ctxWidth/2,this.yOffset=this.ctxHeight/2,this.pathAngle=0,this.startPoint={x:0,y:0},this.endPoint={x:0,y:0},this.speed=0,this.spawned=!1}}])}();function w(t){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},w(t)}function C(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,P(s.key),s)}}function b(t,e,i){return e&&C(t.prototype,e),i&&C(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function P(t){var e=function(t){if("object"!=w(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=w(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==w(e)?e:e+""}function k(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function S(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(S=function(){return!!t})()}function T(t){return T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},T(t)}function D(t,e){return D=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},D(t,e)}var R=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},M=function(t){function e(t,i,s,n){var a,o,r,c;k(this,e),(o=this,r=e,c=[t.length,i],r=T(r),a=function(t,e){if(e&&("object"==w(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(o,S()?Reflect.construct(r,c||[],T(o).constructor):r.apply(o,c))).BulletPool=n;for(var h=0;h<t.length;h++){var l=new O(i,t[h],s);a.pool.push(l)}return a}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&D(t,e)}(e,t),b(e)}(a),O=function(){return b((function t(e,i,s){k(this,t),this.ctx=e,this.type=i;var n=s[i];this.image=n.image,this.width=n.width,this.height=n.height,this.sprite=new o(e,n.image,this.width,this.height,n.srcX,n.srcY),this.setDefaultValues()}),[{key:"spawn",value:function(){this.drawPoint=this.computeDrawPoint(),this.spawned=!0}},{key:"draw",value:function(t){"faceDemon"===this.type&&(this.radius>this.endRadius?this.radius-=Math.abs(100*this.speed):this.speed=this.endSpeed),this.invincibilityFrames++,this.theta-=this.speed,this.drawPoint=this.computeDrawPoint(),"faceDemon"===this.type&&this.invincibilityFrames<50?this.hurtSprite.draw(this.drawPoint.x,this.drawPoint.y):this.sprite.draw(this.drawPoint.x,this.drawPoint.y),this.chanceToFire=Math.floor(101*Math.random()),this.chanceToFire/100<this.fireThreshold&&this.fire(t)}},{key:"resetable",value:function(){return this.life<=0}},{key:"computeDrawPoint",value:function(){return{x:Math.cos(this.theta)*-this.radius+390,y:Math.sin(this.theta)*-this.radius+232}}},{key:"clear",value:function(){this.ctx.clearRect(this.drawPoint.x-5,this.drawPoint.y-5,this.width+10,this.height+10)}},{key:"fire",value:function(t){var e={theta:this.theta,startRadius:this.radius,endRadius:this.radius-20,speed:4,startPoint:{x:this.drawPoint.x+this.width/2,y:this.drawPoint.y+this.height/2}};t.get(e)}},{key:"isHit",value:function(){this.life-=1,this.invincibilityFrames=0}},{key:"setDefaultValues",value:function(){var t=Math.random()<.5?-1:1,e=Math.random()<.5?-1:1;"mouthDemon"===this.type||"eyeDemon"===this.type?(this.theta=Math.PI/2*t,this.speed=R(4,7)/1e3*e,this.radius=R(265,380),this.life=1,this.fireThreshold=.01):"faceDemon"===this.type?(this.theta=Math.PI/2*t,this.speed=R(6,9)/1e3*e,this.endSpeed=2*this.speed,this.radius=400,this.endRadius=R(125,225),this.life=2,this.fireThreshold=.02,this.hurtSprite=new o(this.ctx,this.image,this.width,this.height,31,0)):"bossDemon"===this.type&&(this.speed=.4),this.invincibilityFrames=50,this.chanceToFire=0,this.spawned=!1,this.drawPoint={x:400,y:250}}}])}();function _(t){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_(t)}function Y(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,X(s.key),s)}}function X(t){var e=function(t){if("object"!=_(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=_(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==_(e)?e:e+""}var E=function(){return t=function t(e,i,s,n,a,r,c,h,l,u,p,f,d,v,y){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.fgCanvas=e,this.statsCanvas=i,this.pcCanvas=s,this.optsCanvas=n,this.mobileCanvas=v,this.AssetStore=a,this.demonBulletPool=r,this.pcBulletPool=c,this.lvl1DemonPool=h,this.lvl2DemonPool=l,this.pickupsPool=u,this.player=p,this.movementDirection=f,this.firePosition=y,this.gameStatus=d,this.lastTime=Date.now,this.playerScore=0,this.heart=new o(this.statsCanvas.ctx,this.AssetStore.heart.image,13,13,0,0)},(e=[{key:"updateMovementDirection",value:function(t){this.movementDirection=t}},{key:"updateFirePosition",value:function(t){this.firePosition=t}},{key:"updateGameStatus",value:function(t){this.gameStatus=t}},{key:"drawStandardStartScreen",value:function(){var t,e;this.setupStartScreen(),"over"===this.gameStatus?(t={text:"GAME OVER",size:"36px",x:285,y:70},e={text:"fight! fight! don't let demons win!",size:"22px",x:176,y:105}):(t={text:"SHOOT ALL DEMONS!",size:"36px",x:207,y:70},e={text:"careful! demon power is strong!",size:"22px",x:182,y:105}),this.drawStartScreenMessage(t,e),this.drawControls()}},{key:"drawMobileStartScreen",value:function(){var t,e;this.setupStartScreen(),"over"===this.gameStatus?(t={text:"GAME OVER",size:"36px",x:285,y:70},e={text:"fight! fight! don't let demons win!",size:"19px",x:204,y:105}):(t={text:"SHOOT ALL DEMONS!",size:"34px",x:212,y:70},e={text:"careful! demon power is strong!",size:"20px",x:202,y:105}),this.drawStartScreenMessage(t,e),this.drawMobileControls()}},{key:"setupStartScreen",value:function(){this.optsCanvas.canvas.classList.remove("hidden"),this.clearOptsContext(),this.optsCanvas.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.optsCanvas.ctx.fillRect(0,0,800,500),this.optsCanvas.ctx.fillStyle="white",this.optsCanvas.ctx.strokeStyle="white",this.optsCanvas.ctx.strokeRect(300,385,205,87),this.optsCanvas.ctx.font="60px sf_alien_encountersitalic",this.optsCanvas.ctx.fillText("PLAY",320,450)}},{key:"drawStartScreenMessage",value:function(t,e){this.optsCanvas.ctx.fillStyle="white",this.optsCanvas.ctx.font="".concat(t.size," sf_alien_encountersitalic"),this.optsCanvas.ctx.fillText(t.text,t.x,t.y),this.optsCanvas.ctx.font="".concat(e.size," sf_alien_encountersitalic"),this.optsCanvas.ctx.fillText(e.text,e.x,e.y)}},{key:"drawControls",value:function(){var t,e;"standard"===this.movementDirection?(e={desc1X:70,desc1Y:250,desc2X:90,desc2Y:280,circleX:160,circleY:190},t={desc1X:590,desc1Y:250,desc2X:566,desc2Y:280,circleX:-640,circleY:190}):(e={desc1X:545,desc1Y:250,desc2X:90,desc2Y:280,circleX:640,circleY:190},t={desc1X:109,desc1Y:250,desc2X:566,desc2Y:280,circleX:-160,circleY:190}),this.drawSwapMovementButton(),this.optsCanvas.ctx.fillStyle="white",this.optsCanvas.ctx.strokeStyle="white",this.optsCanvas.ctx.font="18px sf_alien_encountersitalic",this.optsCanvas.ctx.fillText("counterclockwise",e.desc1X,e.desc1Y),this.optsCanvas.ctx.font="20px sf_alien_encountersitalic",this.optsCanvas.ctx.fillText("a   j   left",e.desc2X,e.desc2Y),this.optsCanvas.ctx.beginPath(),this.optsCanvas.ctx.arc(e.circleX,e.circleY,30,Math.PI/2,Math.PI,!0),this.optsCanvas.ctx.lineWidth=2,this.optsCanvas.ctx.stroke(),this.optsCanvas.ctx.beginPath(),this.optsCanvas.ctx.moveTo(Math.abs(e.circleX-30),e.circleY),this.optsCanvas.ctx.lineTo(Math.abs(e.circleX-20),e.circleY-10),this.optsCanvas.ctx.stroke(),this.optsCanvas.ctx.moveTo(Math.abs(e.circleX-30),e.circleY),this.optsCanvas.ctx.lineTo(Math.abs(e.circleX-35),e.circleY-15),this.optsCanvas.ctx.stroke(),this.optsCanvas.ctx.font="18px sf_alien_encountersitalic",this.optsCanvas.ctx.fillText("clockwise",t.desc1X,t.desc1Y),this.optsCanvas.ctx.font="20px sf_alien_encountersitalic",this.optsCanvas.ctx.fillText("d   l   right",t.desc2X,t.desc2Y),this.optsCanvas.ctx.beginPath(),this.optsCanvas.ctx.arc(Math.abs(t.circleX),t.circleY,30,Math.PI/2,0,!1),this.optsCanvas.ctx.lineWidth=2,this.optsCanvas.ctx.stroke(),this.optsCanvas.ctx.beginPath(),this.optsCanvas.ctx.moveTo(Math.abs(t.circleX-30),t.circleY),this.optsCanvas.ctx.lineTo(Math.abs(t.circleX-20),t.circleY-10),this.optsCanvas.ctx.stroke(),this.optsCanvas.ctx.moveTo(Math.abs(t.circleX-30),t.circleY),this.optsCanvas.ctx.lineTo(Math.abs(t.circleX-35),t.circleY-15),this.optsCanvas.ctx.stroke(),this.optsCanvas.ctx.font="16px sf_alien_encountersitalic",this.optsCanvas.ctx.fillText("HP EVERY 1000 Pts!",310,280),this.optsCanvas.ctx.font="24px sf_alien_encountersitalic",this.optsCanvas.ctx.fillText("SPACE TO FIRE WHEN POWER IS FULL",148,340),this.optsCanvas.ctx.beginPath(),this.optsCanvas.ctx.moveTo(145,347),this.optsCanvas.ctx.lineTo(635,347),this.optsCanvas.ctx.stroke(),this.drawGamePadToggleButton(),this.optsCanvas.ctx.font="12px sf_alien_encountersitalic",this.optsCanvas.ctx.fillText("m to mute!",705,440),this.optsCanvas.ctx.fillText("p to pause!",700,460),"playing"!==this.gameStatus&&this.optsCanvas.ctx.fillText("enter to start!",670,480)}},{key:"drawMobileControls",value:function(){var t,e,i;"standard"===this.movementDirection&&"standard"===this.firePosition?(e={descX:5,descY:185,circleX:100,circleY:125},t={descX:45,descY:405,circleX:100,circleY:345},i={x:650,y:265},this.optsCanvas.ctx.strokeStyle="white",this.optsCanvas.ctx.strokeRect(2,2,196,246),this.optsCanvas.ctx.strokeRect(2,252,196,246),this.optsCanvas.ctx.strokeRect(602,2,196,496)):"inverted"===this.movementDirection&&"standard"===this.firePosition?(e={descX:5,descY:405,circleX:100,circleY:345},t={descX:45,descY:185,circleX:100,circleY:125},i={x:650,y:265},this.optsCanvas.ctx.strokeStyle="white",this.optsCanvas.ctx.strokeRect(2,2,196,246),this.optsCanvas.ctx.strokeRect(2,252,196,246),this.optsCanvas.ctx.strokeRect(602,2,196,496)):"standard"===this.movementDirection&&"inverted"===this.firePosition?(e={descX:605,descY:185,circleX:700,circleY:125},t={descX:645,descY:405,circleX:700,circleY:345},i={x:43,y:265},this.optsCanvas.ctx.strokeStyle="white",this.optsCanvas.ctx.strokeRect(602,2,196,246),this.optsCanvas.ctx.strokeRect(602,252,196,246),this.optsCanvas.ctx.strokeRect(2,2,196,496)):"inverted"===this.movementDirection&&"inverted"===this.firePosition&&(e={descX:605,descY:405,circleX:700,circleY:345},t={descX:645,descY:185,circleX:700,circleY:125},i={x:43,y:265},this.optsCanvas.ctx.strokeRect(602,2,196,246),this.optsCanvas.ctx.strokeRect(602,252,196,246),this.optsCanvas.ctx.strokeRect(2,2,196,496)),this.drawSwapMovementButton(),this.drawSwapFireButton(),this.optsCanvas.ctx.fillStyle="white",this.optsCanvas.ctx.strokeStyle="white",this.optsCanvas.ctx.font="18px sf_alien_encountersitalic",this.optsCanvas.ctx.fillText("counterclockwise",e.descX,e.descY),this.optsCanvas.ctx.font="42px sf_alien_encountersitalic",this.optsCanvas.ctx.fillText("FIRE!",i.x,i.y),this.optsCanvas.ctx.font="18px sf_alien_encountersitalic",this.optsCanvas.ctx.fillText("clockwise",t.descX,t.descY),this.optsCanvas.ctx.beginPath(),this.optsCanvas.ctx.arc(e.circleX,e.circleY,30,Math.PI/2,Math.PI,!0),this.optsCanvas.ctx.lineWidth=2,this.optsCanvas.ctx.stroke(),this.optsCanvas.ctx.beginPath(),this.optsCanvas.ctx.moveTo(e.circleX-30,e.circleY),this.optsCanvas.ctx.lineTo(e.circleX-20,e.circleY-10),this.optsCanvas.ctx.stroke(),this.optsCanvas.ctx.moveTo(e.circleX-30,e.circleY),this.optsCanvas.ctx.lineTo(e.circleX-35,e.circleY-15),this.optsCanvas.ctx.stroke(),this.optsCanvas.ctx.beginPath(),this.optsCanvas.ctx.arc(t.circleX,t.circleY,30,Math.PI/2,0,!1),this.optsCanvas.ctx.lineWidth=2,this.optsCanvas.ctx.stroke(),this.optsCanvas.ctx.beginPath(),this.optsCanvas.ctx.moveTo(t.circleX+30,t.circleY),this.optsCanvas.ctx.lineTo(t.circleX+20,t.circleY-10),this.optsCanvas.ctx.stroke(),this.optsCanvas.ctx.moveTo(t.circleX+30,t.circleY),this.optsCanvas.ctx.lineTo(t.circleX+35,t.circleY-15),this.optsCanvas.ctx.stroke()}},{key:"drawSwapMovementButton",value:function(){this.optsCanvas.ctx.strokeStyle="white",this.optsCanvas.ctx.strokeRect(240,165,320,35),this.optsCanvas.ctx.font="20px sf_alien_encountersitalic",this.optsCanvas.ctx.fillText("swap movement direction",250,190)}},{key:"drawSwapFireButton",value:function(){this.optsCanvas.ctx.strokeStyle="white",this.optsCanvas.ctx.strokeRect(290,255,225,35),this.optsCanvas.ctx.font="20px sf_alien_encountersitalic",this.optsCanvas.ctx.fillText("move fire button",300,280)}},{key:"drawGamePadToggleButton",value:function(){this.gamePadConnected&&(this.optsCanvas.ctx.clearRect(20,410,150,80),this.optsCanvas.ctx.fillStyle="rgba(0, 0, 0, 0.8",this.optsCanvas.ctx.fillRect(20,410,150,80),this.optsCanvas.ctx.fillStyle="white",this.optsCanvas.ctx.font="24px sf_alien_encountersitalic",this.gamePadToggle?this.optsCanvas.ctx.fillText("gamepad",33,435):this.optsCanvas.ctx.fillText("keyboard",27,435),this.optsCanvas.ctx.font="12px sf_alien_encountersitalic",this.optsCanvas.ctx.fillText("click here to toggle",20,460),this.optsCanvas.ctx.fillText("gamepad input!",20,480))}},{key:"render",value:function(){this.undrawFGContext(),this.clearPCContext(),this.updatePlayerCharge(),this.drawPlayerRails("circle"),this.player.draw(),this.lvl1DemonPool.draw(),this.lvl2DemonPool.draw(),this.pickupsPool.draw(),this.pcBulletPool.draw("player"),this.demonBulletPool.draw()}},{key:"drawStatusBar",value:function(){this.statsCanvas.ctx.fillStyle="rgba(255, 255, 255, 0.8",this.statsCanvas.ctx.fillRect(0,0,this.statsCanvas.width,this.statsCanvas.height),this.statsCanvas.ctx.strokeStyle="#6816e0",this.statsCanvas.ctx.strokeRect(352,30,97,13),this.drawPlayerHearts(),this.statsCanvas.ctx.fillStyle="black",this.statsCanvas.ctx.strokeStyle="black",this.statsCanvas.ctx.font="22px sf_alien_encountersitalic",this.statsCanvas.ctx.fillText("SCORE",49,21),this.statsCanvas.ctx.font="22px sf_alien_encountersitalic",this.statsCanvas.ctx.fillText("LIFE",204,21),this.statsCanvas.ctx.font="22px sf_alien_encountersitalic",this.statsCanvas.ctx.fillText("POWER",351,21),this.statsCanvas.ctx.font="20px Courier",this.statsCanvas.ctx.fillText("0",50,43),this.statsCanvas.ctx.lineWidth=2,this.statsCanvas.ctx.strokeRect(530,10,100,30),this.statsCanvas.ctx.font="20px sf_alien_encountersitalic",this.statsCanvas.ctx.fillText("MUTE",550,32),this.statsCanvas.ctx.lineWidth=2,this.statsCanvas.ctx.strokeRect(650,10,100,30),this.statsCanvas.ctx.font="20px sf_alien_encountersitalic",this.statsCanvas.ctx.fillText("PAUSE",665,32)}},{key:"drawPlayerHearts",value:function(){this.statsCanvas.ctx.clearRect(200,20,140,40),this.statsCanvas.ctx.fillStyle="rgba(255, 255, 255, 0.8",this.statsCanvas.ctx.fillRect(200,20,140,40);for(var t=0;t<this.player.life;t++)this.heart.draw(205+20*t,30)}},{key:"updatePlayerScore",value:function(t){"mouthDemon"===t||"eyeDemon"===t?this.playerScore+=100:"faceDemon"===t&&(this.playerScore+=150),this.statsCanvas.ctx.clearRect(45,20,150,40),this.statsCanvas.ctx.fillStyle="rgba(255, 255, 255, 0.8",this.statsCanvas.ctx.fillRect(45,20,150,40),this.statsCanvas.ctx.fillStyle="black",this.statsCanvas.ctx.font="20px Courier",this.statsCanvas.ctx.fillText("".concat(this.playerScore),50,43)}},{key:"updatePlayerCharge",value:function(){0===this.player.fireCharge?(this.statsCanvas.ctx.clearRect(353,31,95,11),this.statsCanvas.ctx.fillStyle="rgba(255, 255, 255, 0.8",this.statsCanvas.ctx.fillRect(353,31,95,11)):this.player.fireCharge<20&&(this.statsCanvas.ctx.fillStyle="#6816e0",this.statsCanvas.ctx.fillRect(353,31,5*this.player.fireCharge,11))}},{key:"updateMuteButton",value:function(t){this.statsCanvas.ctx.clearRect(532,12,96,26),this.statsCanvas.ctx.fillStyle="rgba(255, 255, 255, 0.8",this.statsCanvas.ctx.fillRect(532,12,96,26),!0===t?(this.statsCanvas.ctx.fillStyle="black",this.statsCanvas.ctx.font="20px sf_alien_encountersitalic",this.statsCanvas.ctx.fillText("UNMUTE",537,32)):(this.statsCanvas.ctx.fillStyle="black",this.statsCanvas.ctx.font="20px sf_alien_encountersitalic",this.statsCanvas.ctx.fillText("MUTE",550,32))}},{key:"drawPlayerRails",value:function(t){var e=this.pcCanvas.width/2,i=this.pcCanvas.height/2;this.player.fireCharge<20?this.pcCanvas.ctx.strokeStyle="white":this.pcCanvas.ctx.strokeStyle="#6816e0",this.pcCanvas.ctx.beginPath(),this.pcCanvas.ctx.arc(e,i,60,0,2*Math.PI,!0),this.pcCanvas.ctx.lineWidth=2,this.pcCanvas.ctx.stroke()}},{key:"undrawFGContext",value:function(){this.fgCanvas.ctx.fillStyle="rgba(0, 0, 0, 0.1",this.fgCanvas.ctx.fillRect(0,0,800,500)}},{key:"clearFGContext",value:function(){this.fgCanvas.ctx.clearRect(0,0,this.fgCanvas.width,this.fgCanvas.height)}},{key:"clearStatsContext",value:function(){this.statsCanvas.ctx.clearRect(0,0,this.statsCanvas.width,this.statsCanvas.height)}},{key:"clearPCContext",value:function(){this.pcCanvas.ctx.clearRect(0,0,this.pcCanvas.width,this.pcCanvas.height)}},{key:"clearOptsContext",value:function(){this.optsCanvas.ctx.clearRect(0,0,this.optsCanvas.width,this.optsCanvas.height)}},{key:"clearAllContexts",value:function(){this.clearFGContext(),this.clearStatsContext(),this.clearPCContext()}}])&&Y(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();const j=E;function L(t){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},L(t)}function F(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,H(s.key),s)}}function B(t,e,i){return e&&F(t.prototype,e),i&&F(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function H(t){var e=function(t){if("object"!=L(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=L(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==L(e)?e:e+""}function G(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function I(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(I=function(){return!!t})()}function A(t){return A=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},A(t)}function V(t,e){return V=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},V(t,e)}var W=["hp"],z=function(t){function e(t,i){var s,n,a,o;G(this,e),n=this,o=[W.length,t],a=A(a=e),s=function(t,e){if(e&&("object"==L(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(n,I()?Reflect.construct(a,o||[],A(n).constructor):a.apply(n,o));for(var r=0;r<W.length;r++){var c;c=new N(t,"hp",i),s.pool.push(c)}return s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&V(t,e)}(e,t),B(e)}(a),N=function(){return B((function t(e,i,s){G(this,t),this.ctx=e,this.type=i;var n=s[i];this.image=n.image,this.width=n.width,this.height=n.height,this.sprite=new o(e,n.image,this.width,this.height,n.srcX,n.srcY),this.setDefaultValues()}),[{key:"spawn",value:function(){this.drawPoint=this.computeDrawPoint(),this.spawned=!0}},{key:"draw",value:function(){this.invincibilityFrames++,this.theta-=this.speed,this.drawPoint=this.computeDrawPoint(),this.sprite.draw(this.drawPoint.x,this.drawPoint.y)}},{key:"resetable",value:function(){return this.life<=0}},{key:"computeDrawPoint",value:function(){return{x:Math.cos(this.theta)*-this.radius+390,y:Math.sin(this.theta)*-this.radius+232}}},{key:"clear",value:function(){this.ctx.clearRect(this.drawPoint.x-5,this.drawPoint.y-5,this.width+10,this.height+10)}},{key:"isHit",value:function(){this.life-=1,this.invincibilityFrames=0}},{key:"setDefaultValues",value:function(){var t=Math.random()<.5?-1:1,e=Math.random()<.5?-1:1;this.theta=Math.PI/2*t,this.speed=h(4,7)/1e3*e,this.radius=h(200,400),this.life=1,this.invincibilityFrames=50,this.spawned=!1,this.drawPoint={x:400,y:250}}}])}();function U(t){return U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},U(t)}function q(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,J(s.key),s)}}function J(t){var e=function(t){if("object"!=U(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=U(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==U(e)?e:e+""}var K=function(){return t=function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ctx=e.ctx,this.pcFieldWidth=e.width,this.pcFieldHeight=e.height,this.BulletPool=i,this.velocity=0,this.acceleration=.015,this.maxSpeed=.2,this.radius=50,this.fireCharge=0,this.fireCooldown=25,this.invincibilityFrames=50,this.invincibilityColor="white",this.life=3,this.portTheta=-1.23,this.starboardTheta=1.9106,this.bowTheta=Math.PI/2,this.computeAllVerticies(),this.draw=this.draw.bind(this),this.fire=this.fire.bind(this)},(e=[{key:"computeAllVerticies",value:function(){this.portVertex=this.computePortVertex(),this.starboardVertex=this.computeStarboardVertex(),this.bowVertex=this.computeCenterPoints(-15),this.hitboxCenter=this.computeCenterPoints(-35)}},{key:"computeStarboardVertex",value:function(){return{x:Math.cos(this.starboardTheta)*this.radius+this.pcFieldWidth/2,y:-Math.sin(this.starboardTheta)*this.radius+this.pcFieldHeight/2}}},{key:"computePortVertex",value:function(){return{x:Math.cos(this.portTheta)*this.radius+this.pcFieldWidth/2,y:Math.sin(this.portTheta)*this.radius+this.pcFieldHeight/2}}},{key:"computeCenterPoints",value:function(t){return{x:Math.cos(this.bowTheta)*t+this.pcFieldWidth/2,y:Math.sin(this.bowTheta)*t+this.pcFieldHeight/2}}},{key:"move",value:function(t){this.fireCharge++,this.invincibilityFrames++,t.left?(this.velocity<=this.maxSpeed&&(this.velocity+=this.acceleration),this.starboardTheta+=this.velocity,this.portTheta-=this.velocity,this.bowTheta-=this.velocity):t.right?(this.velocity<=this.maxSpeed&&(this.velocity+=this.acceleration),this.starboardTheta-=this.velocity,this.portTheta+=this.velocity,this.bowTheta+=this.velocity):this.velocity=0,t.fire&&this.fireCharge>=this.fireCooldown&&this.fire()}},{key:"fire",value:function(){this.fireCharge=0;var t={theta:this.bowTheta,startRadius:12,endRadius:-8,speed:6};this.BulletPool.get(t)}},{key:"draw",value:function(){this.computeAllVerticies(),this.ctx.beginPath(),this.invincibilityFrames<50?this.ctx.fillStyle=this.invincibilityColor:this.ctx.fillStyle="white",this.ctx.moveTo(this.starboardVertex.x,this.starboardVertex.y),this.ctx.lineTo(this.portVertex.x,this.portVertex.y),this.ctx.lineTo(this.bowVertex.x,this.bowVertex.y),this.ctx.fill()}},{key:"isHit",value:function(){this.life-=1,this.invincibilityFrames=0,this.invincibilityColor="red"}},{key:"isHealed",value:function(){this.life<3&&(this.life+=1,this.invincibilityFrames=0,this.invincibilityColor="lawngreen")}}])&&q(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();const Q=K;function Z(t){return Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Z(t)}function $(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,tt(s.key),s)}}function tt(t){var e=function(t){if("object"!=Z(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=Z(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Z(e)?e:e+""}var et={74:"left",76:"right",68:"right",65:"left",39:"right",37:"left",32:"fire",13:"start",touchLeft:"left",touchRight:"right",touchFire:"fire"},it={};for(var st in et)it[et[st]]=!1;var nt=function(){return t=function t(e,i,s,n,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.fgCanvas={ctx:e.getContext("2d"),width:800,height:500},this.statsCanvas={ctx:i.getContext("2d"),width:800,height:50},this.pcCanvas={ctx:s.getContext("2d"),width:150,height:150},this.optsCanvas={canvas:n,ctx:n.getContext("2d"),width:800,height:500},null===a?(this.isMobile=!1,this.firePosition=null,this.mobileCanvas={}):(this.isMobile=!0,this.firePosition="standard",this.mobileCanvas={canvas:a,ctx:a.getContext("2d"),width:800,height:500}),this.play=this.play.bind(this),this.startRound=this.startRound.bind(this),this.optsCanvasCheckClick=this.optsCanvasCheckClick.bind(this),this.statsCanvasCheckClick=this.statsCanvasCheckClick.bind(this),this.AssetStore=new r(this),this.gamePadConnected=!1,this.gamePadToggle=!1,this.nextHpSpawnScore=500,this.drawLoadingScreen(),this.setupEventListners(e,i,n),this.setupNewGame(),this.setupNewField()},e=[{key:"drawLoadingScreen",value:function(){this.optsCanvas.ctx.fillStyle="black",this.optsCanvas.ctx.font="16px Courier",this.optsCanvas.ctx.fillText("Loading...",50,50)}},{key:"setupEventListners",value:function(t,e,i){var s=this;document.addEventListener("keydown",this.keydown.bind(this)),document.addEventListener("keyup",this.keyup.bind(this)),i.addEventListener("click",(function(t){s.optsCanvasCheckClick(t,i.getBoundingClientRect())})),e.addEventListener("click",(function(t){s.statsCanvasCheckClick(t,e.getBoundingClientRect())})),t.addEventListener("touchstart",(function(e){s.handleStart(e,t.getBoundingClientRect())}),!1),t.addEventListener("touchend",(function(e){s.handleEnd(e,t.getBoundingClientRect())}),!1),t.addEventListener("touchcancel",this.handleCancel,!1),this.ongoingTouches=[],window.addEventListener("gamepadconnected",(function(t){s.mapGamePadButtons(t),s.gamePadConnected=!0})),window.addEventListener("gamepaddisconnected",(function(t){s.gamePadConnected=!1,s.gamePadToggle=!1}))}},{key:"setupNewGame",value:function(){this.demonBulletPool=new x(3,this.fgCanvas,"demonBullet"),this.pcBulletPool=new x(4,this.fgCanvas,"player"),this.setupDemonPools(),this.pickupsPool=new z(this.fgCanvas.ctx,this.AssetStore),this.player=new Q(this.pcCanvas,this.pcBulletPool),this.movementDirection="standard",this.muted=!1,this.paused=!1,this.gameStatus="unbegun"}},{key:"setupDemonPools",value:function(){this.lvl1DemonPool=new M(["mouthDemon","mouthDemon","mouthDemon","eyeDemon","eyeDemon","eyeDemon"],this.fgCanvas.ctx,this.AssetStore,this.demonBulletPool),this.lvl2DemonPool=new M(["faceDemon","faceDemon"],this.fgCanvas.ctx,this.AssetStore,this.demonBulletPool)}},{key:"setupNewField",value:function(){this.field=new j(this.fgCanvas,this.statsCanvas,this.pcCanvas,this.optsCanvas,this.AssetStore,this.demonBulletPool,this.pcBulletPool,this.lvl1DemonPool,this.lvl2DemonPool,this.pickupsPool,this.player,this.movementDirection,this.gameStatus,this.mobileCanvas,this.firePosition)}},{key:"startGame",value:function(){this.field.drawStatusBar(),this.drawStartScreen()}},{key:"drawStartScreen",value:function(){this.isMobile?this.field.drawMobileStartScreen():this.field.drawStandardStartScreen()}},{key:"startRound",value:function(){var t=this;this.AssetStore.backgroundMusic.play(),this.lvl1Timer=new c((function(){t.spawnLvl1Demons()}),5e3),this.lvl2Timer=new c((function(){t.spawnLvl2Demons()}),15e3),this.field.clearOptsContext(),this.optsCanvas.canvas.classList.add("hidden"),this.gameStatus="playing",this.field.updateGameStatus(this.gameStatus),this.startTime=Date.now(),this.lastTime=Date.now(),this.play()}},{key:"pauseSpawnTimers",value:function(){this.lvl1Timer.pause(),this.lvl2Timer.pause()}},{key:"resumeSpawnTimers",value:function(){this.lvl1Timer.resume(),this.lvl2Timer.resume()}},{key:"removeSpawnTimers",value:function(){this.lvl1Timer.clear(),this.lvl2Timer.clear()}},{key:"play",value:function(){var t=this;this.checkGameOver(),this.checkCollisions(),this.gamePadToggle&&this.buttonDown(),this.player.move(it),this.gamePadToggle&&this.buttonUp();var e=Date.now();this.checkLevel1Demons(),this.field.render(),this.spawnHp(),this.paused||setTimeout((function(){t.lastTime=e,requestAnimationFrame(t.play)}),15)}},{key:"checkLevel1Demons",value:function(){for(var t=0,e=0;e<this.lvl1DemonPool.pool.length;e++){var i=this.lvl1DemonPool.pool[e];("mouthDemon"===i.type&&i.spawned||"eyeDemon"===i.type&&i.spawned)&&t++}return t<1&&(this.lvl1DemonPool.get("mouthDemon"),this.lvl1DemonPool.get("eyeDemon")),t}},{key:"spawnLvl1Demons",value:function(){var t=this,e=this.getMaxDemons("lvl1");if(this.checkLevel1Demons()<e){var i=Math.random()<.5?"mouthDemon":"eyeDemon";this.lvl1DemonPool.get(i)}this.lvl1Timer=new c((function(){t.spawnLvl1Demons()}),5e3)}},{key:"spawnLvl2Demons",value:function(){for(var t=this,e=0,i=0;i<this.lvl2DemonPool.pool.length;i++){var s=this.lvl2DemonPool.pool[i];"faceDemon"===s.type&&s.spawned&&e++}e<this.getMaxDemons("lvl2")&&this.lvl2DemonPool.get("faceDemon"),this.lvl2Timer=new c((function(){t.spawnLvl2Demons()}),15e3)}},{key:"checkNumHpPickups",value:function(){for(var t=0,e=0;e<this.pickupsPool.pool.length;e++){var i=this.pickupsPool.pool[e];"hp"===i.type&&i.spawned&&t++}return t}},{key:"spawnHp",value:function(){this.field.playerScore>this.nextHpSpawnScore&&this.checkNumHpPickups()<1&&(this.pickupsPool.get("hp"),this.nextHpSpawnScore+=1e3)}},{key:"getMaxDemons",value:function(t){if(this.lastTime-this.startTime<4e4){if("lvl1"===t)return 4;if("lvl2"===t)return 1}else{if("lvl1"===t)return 6;if("lvl2"===t)return 2}}},{key:"checkCollisions",value:function(){var t=this.pcBulletPool.pool.filter((function(t){return t.spawned}));this.checkPlayerCollision(t),this.checkDemonCollision(t),this.checkHpCollision(t)}},{key:"checkPlayerCollision",value:function(t){for(var e=this.demonBulletPool.pool.filter((function(t){return t.spawned})),i={x:this.player.hitboxCenter.x,y:this.player.hitboxCenter.y,radius:12},s=0;s<t.length;s++){var n=t[s];(this.bulletHitsPC(this.player,i,n.startPoint)||this.bulletHitsPC(this.player,i,n.endPoint))&&this.player.invincibilityFrames>50&&(this.player.isHit(),this.field.drawPlayerHearts())}for(var a=0;a<e.length;a++){var o=e[a];(this.bulletHitsPC(this.player,i,o.startPoint)||this.bulletHitsPC(this.player,i,o.endPoint))&&this.player.invincibilityFrames>50&&(this.player.isHit(),this.field.drawPlayerHearts())}}},{key:"bulletHitsPC",value:function(t,e,i){var s=e.x-t.pcFieldWidth/2+this.fgCanvas.width/2,n=e.y-t.pcFieldHeight/2+this.fgCanvas.height/2;return Math.sqrt(Math.pow(s-i.x,2)+Math.pow(n-i.y,2))<=e.radius}},{key:"checkDemonCollision",value:function(t){for(var e=this.lvl1DemonPool.pool.filter((function(t){return t.spawned})),i=this.lvl2DemonPool.pool.filter((function(t){return t.spawned})),s=e.concat(i),n=0;n<s.length;n++)for(var a=s[n],o=0;o<t.length;o++){var r=t[o],c=a.drawPoint;(this.pcBulletHitsObject(a,c,r.startPoint)||this.pcBulletHitsObject(a,c,r.endPoint))&&a.invincibilityFrames>50&&(this.field.updatePlayerScore(a.type),a.isHit())}}},{key:"checkHpCollision",value:function(t){for(var e=this.pickupsPool.pool.filter((function(t){return"hp"===t.type&&t.spawned})),i=0;i<e.length;i++)for(var s=e[i],n=0;n<t.length;n++){var a=t[n],o=s.drawPoint;(this.pcBulletHitsObject(s,o,a.startPoint)||this.pcBulletHitsObject(s,o,a.endPoint))&&s.invincibilityFrames>50&&this.player.life<3&&(this.player.isHealed(),s.isHit(),this.field.drawPlayerHearts())}}},{key:"pcBulletHitsObject",value:function(t,e,i){return e.x<=i.x&&i.x<=e.x+t.width&&e.y<=i.y&&i.y<=e.y+t.height}},{key:"checkGameOver",value:function(){this.player.life<=0&&(this.paused=!0,this.removeSpawnTimers(),this.gameStatus="over",this.field.updateGameStatus(this.gameStatus),this.drawStartScreen())}},{key:"buttonDown",value:function(){(navigator.getGamepads()[0].buttons[14].pressed||navigator.getGamepads()[0].axes[0]<-.1)&&(it[et.controllerLeft]=!0),(navigator.getGamepads()[0].buttons[15].pressed||navigator.getGamepads()[0].axes[0]>.1)&&(it[et.controllerRight]=!0),(navigator.getGamepads()[0].buttons[0].pressed||navigator.getGamepads()[0].buttons[1].pressed||navigator.getGamepads()[0].buttons[2].pressed||navigator.getGamepads()[0].buttons[3].pressed||navigator.getGamepads()[0].buttons[4].pressed||navigator.getGamepads()[0].buttons[5].pressed)&&(it[et.controllerFire]=!0)}},{key:"buttonUp",value:function(){navigator.getGamepads()[0].buttons[14].pressed||(it[et.controllerLeft]=!1),navigator.getGamepads()[0].buttons[15].pressed||(it[et.controllerRight]=!1),navigator.getGamepads()[0].buttons[0].pressed||navigator.getGamepads()[0].buttons[1].pressed||navigator.getGamepads()[0].buttons[2].pressed||navigator.getGamepads()[0].buttons[3].pressed||navigator.getGamepads()[0].buttons[4].pressed||navigator.getGamepads()[0].buttons[5].pressed||(it[et.controllerFire]=!1)}},{key:"keydown",value:function(t){var e=t.which||t.keyCode||0;13===e&&"playing"!==this.gameStatus&&this.newGame(),77===e&&this.clickMute(),80===e&&this.clickPause(),et[e]&&(t.preventDefault(),it[et[e]]=!0)}},{key:"keyup",value:function(t){var e=t.which||t.keyCode||0;et[e]&&(t.preventDefault(),it[et[e]]=!1)}},{key:"handleStart",value:function(t,e){t.preventDefault();for(var i=t.changedTouches,s=0;s<i.length;s++){var n=i[s],a=n.pageX-e.left,o=n.pageY-e.top;"standard"===this.movementDirection&&"standard"===this.firePosition?0<=a&&a<=200&&0<=o&&o<=299?it[et.touchLeft]=!0:0<=a&&a<=200&&300<=o&&o<=500?it[et.touchRight]=!0:600<=a&&a<=800&&0<=o&&o<=500&&(it[et.touchFire]=!0):"inverted"===this.movementDirection&&"standard"===this.firePosition?0<=a&&a<=200&&0<=o&&o<=299?it[et.touchRight]=!0:0<=a&&a<=200&&300<=o&&o<=500?it[et.touchLeft]=!0:600<=a&&a<=800&&0<=o&&o<=500&&(it[et.touchFire]=!0):("standard"===this.movementDirection&&"inverted"===this.firePosition||"inverted"===this.movementDirection&&"inverted"===this.firePosition)&&(600<=a&&a<=800&&0<=o&&o<=299?it[et.touchLeft]=!0:600<=a&&a<=800&&300<=o&&o<=500?it[et.touchRight]=!0:0<=a&&a<=200&&0<=o&&o<=500&&(it[et.touchFire]=!0)),this.ongoingTouches.push(this.copyTouch(i[s],a,o))}}},{key:"handleEnd",value:function(t,e){t.preventDefault();for(var i=t.changedTouches,s=0;s<i.length;s++){var n=i[s],a=n.pageX-e.left,o=n.pageY-e.top;"standard"===this.movementDirection&&"standard"===this.firePosition?0<=a&&a<=200&&0<=o&&o<=299?it[et.touchLeft]=!1:0<=a&&a<=200&&300<=o&&o<=500?it[et.touchRight]=!1:600<=a&&a<=800&&0<=o&&o<=500&&(it[et.touchFire]=!1):"inverted"===this.movementDirection&&"standard"===this.firePosition?0<=a&&a<=200&&0<=o&&o<=299?it[et.touchRight]=!1:0<=a&&a<=200&&300<=o&&o<=500?it[et.touchLeft]=!1:600<=a&&a<=800&&0<=o&&o<=500&&(it[et.touchFire]=!1):("standard"===this.movementDirection&&"inverted"===this.firePosition||"inverted"===this.movementDirection&&"inverted"===this.firePosition)&&(600<=a&&a<=800&&0<=o&&o<=299?it[et.touchLeft]=!1:600<=a&&a<=800&&300<=o&&o<=500?it[et.touchRight]=!1:0<=a&&a<=200&&0<=o&&o<=500&&(it[et.touchFire]=!1));var r=this.ongoingTouchIndexById(n.identifier);this.ongoingTouches.splice(r,1)}}},{key:"copyTouch",value:function(t,e,i){return{identifier:t.identifier,posX:e,posY:i}}},{key:"ongoingTouchIndexById",value:function(t){for(var e=0;e<this.ongoingTouches.length;e++)if(this.ongoingTouches[e].identifier==t)return e;return-1}},{key:"statsCanvasCheckClick",value:function(t,e){t.preventDefault();var i=t.clientX-e.left,s=t.clientY-e.top;530<=i&&i<=630&&10<=s&&s<=40?this.clickMute():650<=i&&i<=750&&10<=s&&s<=40&&this.clickPause()}},{key:"optsCanvasCheckClick",value:function(t,e){t.preventDefault();var i=t.clientX-e.left,s=t.clientY-e.top;240<=i&&i<=560&&165<=s&&s<=200?this.swapMovementDirection():300<=i&&i<=505&&385<=s&&s<=472?"unbegun"===this.gameStatus?this.startRound():"playing"===this.gameStatus?this.clickPause():"over"===this.gameStatus&&this.newGame():20<=i&&i<=170&&410<=s&&s<=490?(this.gamePadToggle=!this.gamePadToggle,this.field.drawGamePadToggleButton()):290<=i&&i<=515&&255<=s&&s<=290&&!0===this.isMobile&&this.moveFireButton()}},{key:"clickMute",value:function(){!0===this.muted?(this.muted=!1,this.AssetStore.backgroundMusic.volume=.25):(this.muted=!0,this.AssetStore.backgroundMusic.volume=0),this.field.updateMuteButton(this.muted)}},{key:"clickPause",value:function(){this.paused&&"playing"===this.gameStatus?(this.paused=!1,this.resumeSpawnTimers(),this.field.clearOptsContext(),this.optsCanvas.canvas.classList.add("hidden"),this.play()):this.paused||"playing"!==this.gameStatus||(this.paused=!0,this.pauseSpawnTimers(),this.drawStartScreen())}},{key:"newGame",value:function(){this.field.clearAllContexts(),this.setupNewGame(),this.setupNewField(),this.field.drawStatusBar(),this.startRound()}},{key:"swapMovementDirection",value:function(){"standard"===this.movementDirection?(this.movementDirection="inverted",et[74]="right",et[76]="left",et[68]="left",et[65]="right",et[39]="left",et[37]="right"):(this.movementDirection="standard",et[74]="left",et[76]="right",et[68]="right",et[65]="left",et[39]="right",et[37]="left"),this.field.updateMovementDirection(this.movementDirection),this.drawStartScreen()}},{key:"moveFireButton",value:function(){"standard"===this.firePosition?this.firePosition="inverted":this.firePosition="standard",this.field.updateFirePosition(this.firePosition),this.drawStartScreen()}},{key:"mapGamePadButtons",value:function(t){et.controllerFire="fire",et.controllerLeft="left",et.controllerRight="right",it.controllerFire=!1,it.controllerLeft=!1,it.controllerRight=!1}}],e&&$(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();document.addEventListener("DOMContentLoaded",(function(){var t=document.getElementById("foreground-canvas"),e=document.getElementById("player-canvas"),i=document.getElementById("stats-canvas"),s=document.getElementById("options-canvas"),n=null;void 0===window.orientation&&-1===navigator.userAgent.indexOf("IEMobile")||(document.createElement("canvas"),function(){throw new TypeError('"mobileCanvas" is read-only')}(),n.id="mobile-canvas",n.width="800",n.height="500",document.getElementsByClassName("game-area")[0].appendChild(n)),new nt(t,i,e,s,n)}))})();
//# sourceMappingURL=bundle.js.map